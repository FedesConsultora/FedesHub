# --- HTTP 80: redirige a HTTPS ---
<VirtualHost *:80>
  ServerName  fedes.ai
  ServerAlias www.fedes.ai
  RewriteEngine On
  RewriteRule ^/(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]
</VirtualHost>

# --- HTTPS 443: LANDING est치tica ---
<VirtualHost *:443>
  ServerName  fedes.ai
  ServerAlias www.fedes.ai

  # Solo archivos est치ticos (React build)
  DocumentRoot /var/www/landing/current
  <Directory /var/www/landing/current>
    AllowOverride All
    Require all granted
    Options -Indexes +FollowSymLinks
  </Directory>

  # Asegurar que NO haya NADA de proxy en este vhost
  ProxyRequests Off
  ProxyPreserveHost On
  ProxyPass /.well-known/ !
  ProxyPass /api           !
  ProxyPass /uploads       !
  ProxyPass /sockjs-node   !
  ProxyPass /socket.io     !
  ProxyPass /              !

  # Salud ACME (por si renov치s SSL)
  Alias /.well-known/acme-challenge/ "/var/www/landing/current/.well-known/acme-challenge/"
  <Directory "/var/www/landing/current/.well-known/acme-challenge">
    Options None
    AllowOverride None
    Require all granted
  </Directory>

  # Seguridad b치sica y logs
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"

  ErrorLog  "|/opt/apache/bin/rotatelogs /opt/apache/logs/fedes.ai.error.%Y%m%d.log 86400"
  CustomLog "|/opt/apache/bin/rotatelogs /opt/apache/logs/fedes.ai.access.%Y%m%d.log 86400" combined
</VirtualHost>


